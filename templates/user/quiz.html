{% extends "user/base.html" %}
{% block content %}
<div class="container" id="quiz-root"
     data-deadline="{{ deadline_ts }}"
     data-disabled="{{ 1 if disabled else 0 }}"
     data-passing="{{ passing }}">
  <!-- Header -->
  <div class="header text-center my-4">
    <h1>Post Test Quiz</h1>
    <p class="text-muted">Jawablah semua pertanyaan dengan benar sebelum waktu habis</p>
  </div>

  <!-- Progress / Timer -->
  <div class="progress-container mb-4">
    <div class="progress-header d-flex justify-content-between align-items-center mb-2">
      <div class="question-counter">
        <span id="counter">1</span> / {{ questions|length }}
      </div>
      <div class="timer" id="quiz_timer">‚è±Ô∏è {{ minutes }}:00</div>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" id="progress_fill" style="width:0"></div>
    </div>
  </div>

  <!-- Form Quiz -->
  <form method="post" id="quiz-form">
    {% set letters = ['A','B','C','D','E','F'] %}
    {% for q in questions %}
    <div class="quiz-card step"
         data-step="{{ loop.index0 }}"
         data-correct="{{ q.answer }}"
         {% if not loop.first %}style="display:none"{% endif %}>
      <div class="question mb-3">
        <strong>{{ loop.index }}.</strong> {{ q.question }}
      </div>
      <div class="answers">
        {% for c in q.choices %}
        <label class="answer-option">
          <input type="radio" name="{{ q.id }}" value="{{ c }}" required>
          <span class="answer-letter">{{ letters[loop.index0] }}</span>
          <span class="answer-text">{{ c }}</span>
        </label>
        {% endfor %}
      </div>
    </div>
    {% endfor %}

    <!-- Controls -->
    <div class="controls mt-4 d-flex justify-content-between">
      <button type="button" class="btn secondary" id="prevBtn" disabled>‚Üê Previous</button>
      <div>
        <button type="button" class="btn" id="nextBtn">Next ‚Üí</button>
        <button type="submit" class="btn success" id="submitBtn" style="display:none">üéØ Submit Quiz</button>
      </div>
    </div>
  </form>
</div>

<!-- === Modal Result === -->
<div id="resultModal" class="result-modal hidden">
  <div class="modal-content text-center p-4">
    <div class="celebration" id="modalIcon"></div>
    <h3 id="modalTitle"></h3>
    <div class="score-display" id="modalScore">0%</div>
    <p id="modalDesc">0 out of {{ questions|length if questions else '' }} questions correct</p>

    {% if go_to_coding %}
      <!-- User baru selesai QUIZ -->
      <a href="{{ url_for('code.code') }}" class="btn btn-primary mb-2">Lanjut ke Coding Test</a>
      <a href="{{ url_for('result.result') }}" class="btn btn-outline-secondary mb-2">Lihat Detail Skor</a>
    {% elif go_to_quiz %}
      <!-- User baru selesai CODING -->
      <a href="{{ url_for('quiz.quiz') }}" class="btn btn-primary mb-2">Lanjut ke Quiz</a>
      <a href="{{ url_for('result.result') }}" class="btn btn-outline-secondary mb-2">Lihat Detail Skor</a>
    {% else %}
      <!-- Kalau sudah ngerjain dua-duanya -->
      <a href="{{ url_for('result.result') }}" class="btn btn-primary mb-2">Lihat Detail Skor</a>
    {% endif %}
  </div>
</div>


{% endblock %}
