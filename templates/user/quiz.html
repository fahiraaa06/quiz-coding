{# templates/user/quiz.html #}
{% extends "user/base.html" %}
{% block content %}
<header class="site-header">
    <h1>Quiz Pilihan Ganda</h1>
</header>
<main class="content">
    <section class="card">
        <div id="questionContainer">
            <!-- Daftar pertanyaan di-render di sini melalui Jinja -->
            {% for q in questions %}
                <div class="question-card">
                    <div class="question-number">Question {{ loop.index }}</div>
                    <div class="question-text">{{ q.question }}</div>
                    <div class="options">
                        {% for c in q.choices %}
                        <label class="option">
                            <input type="radio" name="{{ q.id }}" value="{{ c }}" required>
                            <span>{{ c }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
            <button class="btn primary-btn" type="submit">Submit Quiz</button>
        </div>
    </section>
</main>
{% endblock %}
{% block scripts %}

<script>
(() => {
  const root        = document.getElementById('quiz-root');
  const form        = document.getElementById('quiz-form');
  const timerEl     = document.getElementById('quiz_timer');
  const submitBtn   = document.getElementById('quiz_submit');
  const radios      = root.querySelectorAll('input[type="radio"]');

  const deadlineSec = root ? parseInt(root.dataset.deadline, 10) : 0;
  const preDisabled = root ? root.dataset.disabled === '1' : false;
  const endMs       = deadlineSec * 1000;

  const setDisabled = (state) => {
    if (submitBtn) submitBtn.disabled = state;
    radios.forEach(r => r.disabled = state);
    if (state && submitBtn) submitBtn.textContent = 'Waktu habis';
  };

  // Terapkan kondisi awal dari server
  setDisabled(preDisabled);

  const tick = () => {
    if (!endMs) return; // tidak ada deadline -> tanpa timer
    const left = Math.max(0, Math.floor((endMs - Date.now()) / 1000));
    const m = String(Math.floor(left / 60)).padStart(2, '0');
    const s = String(left % 60).padStart(2, '0');
    if (timerEl) timerEl.textContent = `‚è≥ ${m}:${s}`;
    if (left <= 0) setDisabled(true); else setTimeout(tick, 1000);
  };

  tick();
})();
</script>
{% endblock %}
